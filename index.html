<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>H·ªô Chi·∫øu T∆∞∆°ng Lai - Passport to the Future</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* --- 1. CSS CHUNG --- */
        :root {
            --primary: #4e54c8;
            --secondary: #8f94fb;
            --success: #2ed573;
            --danger: #ff4757;
            --text: #2f3542;
            --bg: #f1f2f6;
        }

        body { 
            font-family: 'Nunito', sans-serif; 
            background: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%);
            margin: 0; padding: 0; 
            color: var(--text);
            height: 100vh; overflow: hidden; /* App-like feel */
        }
        
        .app-container {
            max-width: 480px; height: 100%; margin: 0 auto;
            background: white; position: relative;
            box-shadow: 0 0 20px rgba(0,0,0,0.05);
            display: flex; flex-direction: column;
            overflow-y: auto; overflow-x: hidden;
        }

        /* --- SCREENS (QU·∫¢N L√ù C√ÅC M√ÄN H√åNH) --- */
        .screen {
            display: none; flex-direction: column; 
            height: 100%; padding: 20px; box-sizing: border-box;
            animation: fadeIn 0.4s ease-out;
        }
        .screen.active { display: flex; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- UI COMPONENTS --- */
        h1, h2, h3 { text-align: center; margin: 10px 0; color: var(--primary); }
        .logo-area { text-align: center; margin-bottom: 20px; }
        .logo-area img { width: 80px; height: 80px; object-fit: contain; }

        .btn {
            width: 100%; padding: 15px; border: none; border-radius: 12px;
            font-size: 16px; font-weight: 700; cursor: pointer;
            margin-bottom: 15px; transition: transform 0.2s;
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        .btn:active { transform: scale(0.98); }
        .btn-primary { background: var(--primary); color: white; box-shadow: 0 4px 15px rgba(78, 84, 200, 0.3); }
        .btn-outline { background: white; border: 2px solid var(--primary); color: var(--primary); }
        .btn-success { background: var(--success); color: white; }
        
        input, select {
            width: 100%; padding: 14px; margin-bottom: 15px;
            border: 2px solid #eee; border-radius: 10px;
            font-size: 16px; box-sizing: border-box; outline: none;
        }
        input:focus { border-color: var(--secondary); }

        /* --- SCREEN 1: HOME --- */
        #screen-home { justify-content: center; }
        .home-btn-group { margin-top: 30px; }

        /* --- SCREEN 2: LIBRARY (T√åM HI·ªÇU NGH·ªÄ) --- */
        .lib-grid { 
            display: grid; grid-template-columns: 1fr 1fr; gap: 15px; 
            overflow-y: auto; padding-bottom: 20px;
        }
        .lib-card {
            background: white; border-radius: 10px; overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1); cursor: pointer;
        }
        .lib-card img { width: 100%; height: 120px; object-fit: cover; }
        .lib-info { padding: 10px; }
        .lib-name { font-weight: bold; font-size: 14px; margin-bottom: 5px; }
        .lib-group { font-size: 11px; color: #666; background: #eee; padding: 2px 6px; border-radius: 4px; }
        .header-nav { display: flex; align-items: center; margin-bottom: 15px; }
        .back-btn { background: none; border: none; font-size: 24px; cursor: pointer; color: #666; padding-right: 15px;}

        /* --- SCREEN 3: INPUT INFO --- */
        .gender-group { display: flex; gap: 10px; margin-bottom: 20px; }
        .gender-opt { 
            flex: 1; padding: 12px; text-align: center; 
            border: 1px solid #ddd; border-radius: 8px; cursor: pointer; 
        }
        .gender-opt.selected { background: var(--primary); color: white; border-color: var(--primary); }

        /* --- SCREEN 4: SWIPE (TINDER) --- */
        #card-zone { 
            position: relative; flex-grow: 1; margin: 10px 0; perspective: 1000px;
        }
        .tinder-card {
            position: absolute; width: 100%; height: 100%; top: 0; left: 0;
            background: white; border-radius: 20px; 
            box-shadow: 0 5px 25px rgba(0,0,0,0.1);
            transform-origin: 50% 100%;
            overflow: hidden;
        }
        .card-img-area { height: 65%; position: relative; }
        .card-img-area img { width: 100%; height: 100%; object-fit: cover; }
        .card-overlay {
            position: absolute; bottom: 0; left: 0; width: 100%;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
            color: white; padding: 15px; box-sizing: border-box;
        }
        .card-info-area { padding: 20px; height: 35%; overflow-y: auto; background: white; }
        
        .control-bar { display: flex; justify-content: center; gap: 30px; padding: 10px 0; }
        .action-btn {
            width: 60px; height: 60px; border-radius: 50%; border: none;
            font-size: 24px; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1); cursor: pointer; transition: 0.2s;
        }
        .btn-dislike { background: white; color: var(--danger); border: 2px solid #eee; }
        .btn-like { background: white; color: var(--success); border: 2px solid #eee; }
        .btn-dislike:active { background: #ffebee; transform: scale(0.9); }
        .btn-like:active { background: #e8f5e9; transform: scale(0.9); }

        /* --- SCREEN 5: REFINE (CH·ªåN TOP 5) --- */
        .liked-list { flex-grow: 1; overflow-y: auto; margin: 10px 0; }
        .refine-item {
            display: flex; align-items: center; padding: 12px; 
            background: white; margin-bottom: 8px; border-radius: 8px;
            border: 2px solid transparent; cursor: pointer;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        .refine-item.active { border-color: var(--success); background: #f0fff4; }
        .refine-item img { width: 40px; height: 40px; border-radius: 50%; margin-right: 12px; object-fit: cover;}
        .check-icon { margin-left: auto; color: var(--success); opacity: 0; }
        .refine-item.active .check-icon { opacity: 1; }

        /* --- SCREEN 6: RESULT --- */
        .ai-box { background: #eef2f5; padding: 15px; border-radius: 12px; font-size: 14px; line-height: 1.6; margin-bottom: 20px;}
        .loader { border: 3px solid #f3f3f3; border-top: 3px solid var(--primary); border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; display: inline-block; margin-right: 10px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* Modal Popup (Chi ti·∫øt ngh·ªÅ) */
        #modal-info {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 999; display: none;
            justify-content: center; align-items: end;
        }
        .modal-content {
            background: white; width: 100%; max-width: 480px; height: 85vh;
            border-radius: 20px 20px 0 0; padding: 20px; box-sizing: border-box;
            overflow-y: auto; animation: slideUp 0.3s; position: relative;
        }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .close-modal { position: absolute; top: 15px; right: 15px; font-size: 24px; cursor: pointer; color: #999; }

    </style>
</head>
<body>

<div class="app-container">
    
    <div id="screen-home" class="screen active">
        <div class="logo-area">
            <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" alt="Logo">
            <h2>H·ªò CHI·∫æU T∆Ø∆†NG LAI</h2>
            <p style="color: #777; font-size: 14px;">Kh√°m ph√° b·∫£n th√¢n - ƒê·ªãnh h∆∞·ªõng ngh·ªÅ nghi·ªáp</p>
        </div>
        
        <div class="home-btn-group">
            <button class="btn btn-outline" onclick="goToScreen('screen-library')">
                üîç T√åM HI·ªÇU NGH·ªÄ
            </button>
            
            <button class="btn btn-primary" onclick="goToScreen('screen-input')">
                üîÆ D·ª∞ ƒêO√ÅN (AI)
            </button>
        </div>
        <p style="text-align:center; font-size:12px; color:#aaa; margin-top:auto;">
            Phi√™n b·∫£n th·ª≠ nghi·ªám v2.0
        </p>
    </div>

    <div id="screen-library" class="screen">
        <div class="header-nav">
            <button class="back-btn" onclick="goToScreen('screen-home')">‚Üê</button>
            <h3 style="margin:0">Th∆∞ Vi·ªán Ngh·ªÅ</h3>
        </div>
        <input type="text" id="search-lib" placeholder="Nh·∫≠p t√™n ngh·ªÅ..." onkeyup="filterLib()">
        <div id="lib-container" class="lib-grid">
            </div>
    </div>

    <div id="screen-input" class="screen">
        <div class="header-nav">
            <button class="back-btn" onclick="goToScreen('screen-home')">‚Üê</button>
            <h3 style="margin:0">Th√¥ng Tin C·ªßa B·∫°n</h3>
        </div>
        
        <label>H·ªç v√† t√™n</label>
        <input type="text" id="inp-name" placeholder="Nguy·ªÖn VƒÉn A">
        
        <label>NƒÉm sinh (ƒê·ªÉ ch·ªçn ·∫£nh ph√π h·ª£p)</label>
        <input type="number" id="inp-yob" placeholder="2008">
        
        <label>Email (Nh·∫≠n k·∫øt qu·∫£)</label>
        <input type="email" id="inp-email" placeholder="email@example.com">
        
        <label>Gi·ªõi t√≠nh</label>
        <div class="gender-group">
            <div class="gender-opt selected" onclick="selectGender('Nam', this)">Nam</div>
            <div class="gender-opt" onclick="selectGender('N·ªØ', this)">N·ªØ</div>
        </div>

        <button class="btn btn-primary" style="margin-top:auto" onclick="startQuiz()">
            B·∫ÆT ƒê·∫¶U QU·∫∏T TH·∫∫ ‚ûî
        </button>
    </div>

    <div id="screen-swipe" class="screen">
        <div style="display:flex; justify-content:space-between; align-items:center">
            <small style="color:#999">Ti·∫øn ƒë·ªô: <span id="progress-count">0/20</span></small>
            <button class="btn-outline" style="width:auto; padding:5px 10px; font-size:12px" onclick="quitQuiz()">Tho√°t</button>
        </div>
        
        <div id="card-zone">
            </div>

        <div class="control-bar">
            <button class="action-btn btn-dislike" onclick="userSwipe('left')">‚úï</button>
            <button class="action-btn btn-like" onclick="userSwipe('right')">‚ù§</button>
        </div>
        <p style="text-align:center; font-size:12px; color:#ccc">Ch·∫°m v√†o ·∫£nh ƒë·ªÉ xem chi ti·∫øt ngh·ªÅ</p>
    </div>

    <div id="screen-refine" class="screen">
        <h3>Ch·ªçn Top 5 Ngh·ªÅ B·∫°n Th√≠ch</h3>
        <p style="font-size:13px; color:#666">B·∫°n ƒë√£ th√≠ch <b id="liked-count">0</b> ngh·ªÅ. H√£y ch·ªçn ra t·ªëi ƒëa 5 ngh·ªÅ b·∫°n ·∫•n t∆∞·ª£ng nh·∫•t ƒë·ªÉ AI ph√¢n t√≠ch.</p>
        
        <div id="refine-list" class="liked-list">
            </div>

        <button id="btn-analyze" class="btn btn-success" disabled onclick="finishAndAnalyze()">
            PH√ÇN T√çCH K·∫æT QU·∫¢
        </button>
    </div>

    <div id="screen-result" class="screen">
        <h3>H·ªì S∆° C·ªßa B·∫°n</h3>
        <div class="ai-box" style="background:white; border:1px solid #eee">
            <b>H·ªç t√™n:</b> <span id="res-name"></span><br>
            <b>Email:</b> <span id="res-email"></span><br>
            <b>Nh√≥m Holland:</b> <span id="res-holland" style="color:var(--primary); font-weight:bold"></span>
        </div>

        <h4>ü§ñ AI Ph√¢n T√≠ch & G·ª£i √ù</h4>
        <div id="ai-content" class="ai-box">
            <div style="text-align:center; padding:20px">
                <div class="loader"></div> ƒêang k·∫øt n·ªëi chuy√™n gia AI...
            </div>
        </div>

        <button id="btn-send-mail" class="btn btn-primary" onclick="sendEmail()">
            üìß G·ª¨I V·ªÄ EMAIL
        </button>
        <button class="btn btn-outline" onclick="location.reload()">L√†m l·∫°i t·ª´ ƒë·∫ßu</button>
    </div>

</div>

<div id="modal-info">
    <div class="modal-content">
        <span class="close-modal" onclick="closeModal()">√ó</span>
        <h2 id="m-name-vn" style="margin-bottom:5px"></h2>
        <i id="m-name-en" style="color:#666; display:block; margin-bottom:15px"></i>
        <div style="background:#f9f9f9; padding:10px; border-radius:8px; margin-bottom:15px">
            <b>Nh√≥m:</b> <span id="m-group"></span>
        </div>
        <p><b>M√¥ t·∫£:</b> <span id="m-desc"></span></p>
        <p><b>M√¥n h·ªçc:</b> <span id="m-subjects"></span></p>
        <p><b>Ph·∫©m ch·∫•t:</b> <span id="m-qualities"></span></p>
        <p><b>Th√∫ v·ªã:</b> <span id="m-fact"></span></p>
    </div>
</div>

<script>
    /* --- C·∫§U H√åNH --- */
    const CONFIG = {
        AI_KEY: "AIzaSyBvbJ9HBeJSqrWDI0HNWfvJZ29huFD5b9c", // Thay b·∫±ng Key c·ªßa b·∫°n
        SHEET_CSV: "https://docs.google.com/spreadsheets/d/e/2PACX-1vTn_AISCPAvNtkZZcjcMn4_80wXuarbci9SyqBqDnnHpB5WM1QShft3xU7HHxgIP_AKz9ffyoEsAd9D/pub?output=csv",
        SCRIPT_URL: "https://script.google.com/macros/s/AKfycbyliagMSTi8XV2z7wR2hCD2gm_25sXqftbw-J26gOE85bHflVyjAyShSiE2xywBjdqJ-A/exec" // Thay b·∫±ng Link WebApp c·ªßa b·∫°n
    };

    /* --- BI·∫æN TO√ÄN C·ª§C --- */
    let rawData = [];
    let user = { name: '', yob: '', email: '', gender: 'Nam', likedItems: [], finalSelection: [], scores: {} };
    let quizQueue = [];
    let currentIndex = 0;

    // 1. KH·ªûI T·∫†O & LOAD D·ªÆ LI·ªÜU
    window.onload = async function() {
        try {
            const res = await fetch(CONFIG.SHEET_CSV);
            const text = await res.text();
            rawData = parseCSV(text);
            console.log("Loaded jobs:", rawData.length);
            renderLibrary(rawData); // Render s·∫µn th∆∞ vi·ªán
        } catch (e) {
            alert("L·ªói t·∫£i d·ªØ li·ªáu CSV!");
        }
    };

    function parseCSV(text) {
        // H√†m ph√¢n t√≠ch CSV ƒë∆°n gi·∫£n
        const lines = text.trim().split('\n');
        const result = [];
        for(let i=1; i<lines.length; i++) {
            // Regex x·ª≠ l√Ω d·∫•u ph·∫©y trong ngo·∫∑c k√©p
            const row = lines[i].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/); 
            if(row.length < 2) continue;
            const clean = (t) => t ? t.replace(/^"|"$/g, '').trim() : "";
            result.push({
                id: clean(row[0]), nameVN: clean(row[1]), nameEN: clean(row[2]),
                group: clean(row[3]), img1: clean(row[4]), img2: clean(row[5]),
                desc: clean(row[6]), subjects: clean(row[7]), qualities: clean(row[8]), fact: clean(row[9])
            });
        }
        return result;
    }

    // 2. ƒêI·ªÄU H∆Ø·ªöNG M√ÄN H√åNH
    function goToScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    // 3. LOGIC LIBRARY (T√åM HI·ªÇU NGH·ªÄ)
    function renderLibrary(list) {
        const container = document.getElementById('lib-container');
        container.innerHTML = list.map(item => `
            <div class="lib-card" onclick="showModal('${item.id}')">
                <img src="${item.img2 || 'https://via.placeholder.com/150'}" loading="lazy">
                <div class="lib-info">
                    <div class="lib-name">${item.nameVN}</div>
                    <span class="lib-group">${item.group}</span>
                </div>
            </div>
        `).join('');
    }

    function filterLib() {
        const key = document.getElementById('search-lib').value.toLowerCase();
        const filtered = rawData.filter(i => i.nameVN.toLowerCase().includes(key));
        renderLibrary(filtered);
    }

    // 4. LOGIC NH·∫¨P LI·ªÜU & B·∫ÆT ƒê·∫¶U QUIZ
    function selectGender(g, el) {
        user.gender = g;
        document.querySelectorAll('.gender-opt').forEach(e => e.classList.remove('selected'));
        el.classList.add('selected');
    }

    function startQuiz() {
        user.name = document.getElementById('inp-name').value;
        user.yob = document.getElementById('inp-yob').value;
        user.email = document.getElementById('inp-email').value;

        if(!user.name || !user.yob) { alert("Vui l√≤ng nh·∫≠p t√™n v√† nƒÉm sinh!"); return; }

        // Logic ch·ªçn ·∫£nh theo ƒë·ªô tu·ªïi (C·∫•p 2: <15 tu·ªïi -> ·∫¢nh 1, C·∫•p 3: >15 tu·ªïi -> ·∫¢nh 2)
        const age = new Date().getFullYear() - parseInt(user.yob);
        const useImg1 = (age >= 10 && age <= 15);

        // Chu·∫©n b·ªã d·ªØ li·ªáu Quiz (Random 20 c√¢u)
        quizQueue = rawData.sort(() => 0.5 - Math.random()).slice(0, 20).map(item => ({
            ...item,
            displayImg: useImg1 ? item.img1 : item.img2
        }));
        
        currentIndex = 0;
        user.likedItems = [];
        user.scores = {};
        
        renderCard();
        goToScreen('screen-swipe');
    }

    // 5. LOGIC QU·∫∏T TH·∫∫ (SWIPE)
    function renderCard() {
        if(currentIndex >= quizQueue.length) {
            goToRefineScreen();
            return;
        }
        
        const item = quizQueue[currentIndex];
        document.getElementById('progress-count').innerText = `${currentIndex + 1}/${quizQueue.length}`;
        
        const html = `
            <div class="tinder-card" id="active-card">
                <div class="card-img-area" onclick="showModal('${item.id}')">
                    <img src="${item.displayImg}" draggable="false">
                    <div class="card-overlay">
                        <h2 style="margin:0; color:white">${item.nameVN}</h2>
                        <i style="opacity:0.8">${item.nameEN}</i>
                    </div>
                </div>
                <div class="card-info-area">
                    <p style="margin-top:0"><b>M√¥ t·∫£:</b> ${item.desc.substring(0, 100)}...</p>
                    <small style="color:#666">(Ch·∫°m ·∫£nh ƒë·ªÉ xem chi ti·∫øt)</small>
                </div>
            </div>
        `;
        document.getElementById('card-zone').innerHTML = html;
        
        // Th√™m logic vu·ªët (Swipe Touch Event) - Gi·∫£n l∆∞·ª£c cho code ng·∫Øn
        initSwipeEvent();
    }

    function userSwipe(dir) {
        const card = document.getElementById('active-card');
        if(!card) return;

        // Animation
        card.style.transition = 'transform 0.4s ease-out, opacity 0.4s';
        card.style.transform = dir === 'left' ? 'translateX(-120%) rotate(-20deg)' : 'translateX(120%) rotate(20deg)';
        card.style.opacity = '0';

        // Logic Data
        const item = quizQueue[currentIndex];
        if(dir === 'right') {
            user.likedItems.push(item);
            // C·ªông ƒëi·ªÉm Holland
            const g = item.group.charAt(0);
            user.scores[g] = (user.scores[g] || 0) + 1;
        }

        setTimeout(() => {
            currentIndex++;
            renderCard();
        }, 300);
    }
    
    // Gi·∫£ l·∫≠p swipe touch (B·∫°n c√≥ th·ªÉ th√™m th∆∞ vi·ªán Hammer.js n·∫øu mu·ªën m∆∞·ª£t h∆°n)
    function initSwipeEvent() {
        const card = document.getElementById('active-card');
        let startX = 0;
        card.addEventListener('touchstart', e => startX = e.touches[0].clientX);
        card.addEventListener('touchend', e => {
            const delta = e.changedTouches[0].clientX - startX;
            if(delta > 50) userSwipe('right');
            else if(delta < -50) userSwipe('left');
        });
    }

    // 6. LOGIC S√ÄNG L·ªåC (REFINE)
    function goToRefineScreen() {
        if(user.likedItems.length === 0) {
            // N·∫øu kh√¥ng th√≠ch g√¨, ch·ªçn ƒë·∫°i top 3 t·ª´ danh s√°ch ƒë√£ xem
            user.finalSelection = quizQueue.slice(0,3);
            finishAndAnalyze(); 
            return;
        }
        
        goToScreen('screen-refine');
        document.getElementById('liked-count').innerText = user.likedItems.length;
        
        const container = document.getElementById('refine-list');
        container.innerHTML = user.likedItems.map(item => `
            <div class="refine-item" onclick="toggleSelection('${item.id}', this)">
                <img src="${item.displayImg}">
                <div>
                    <b>${item.nameVN}</b><br>
                    <small>${item.group}</small>
                </div>
                <div class="check-icon">‚úî</div>
            </div>
        `).join('');
        
        user.finalSelection = [];
        checkRefineBtn();
    }

    function toggleSelection(id, el) {
        if(el.classList.contains('active')) {
            el.classList.remove('active');
            user.finalSelection = user.finalSelection.filter(i => i.id !== id);
        } else {
            if(user.finalSelection.length >= 5) { alert("Ch·ªâ ƒë∆∞·ª£c ch·ªçn t·ªëi ƒëa 5 ngh·ªÅ!"); return; }
            el.classList.add('active');
            const item = user.likedItems.find(i => i.id === id);
            user.finalSelection.push(item);
        }
        checkRefineBtn();
    }

    function checkRefineBtn() {
        const btn = document.getElementById('btn-analyze');
        btn.disabled = user.finalSelection.length === 0;
        btn.innerText = `PH√ÇN T√çCH (${user.finalSelection.length}/5)`;
    }

    // 7. LOGIC K·∫æT QU·∫¢ & AI
    async function finishAndAnalyze() {
        goToScreen('screen-result');
        document.getElementById('res-name').innerText = user.name;
        document.getElementById('res-email').innerText = user.email;
        
        // T√¨m nh√≥m Holland cao nh·∫•t
        const sorted = Object.entries(user.scores).sort((a,b) => b[1] - a[1]);
        const topHolland = sorted.slice(0,2).map(i => i[0]).join(""); // V√≠ d·ª•: RI
        document.getElementById('res-holland').innerText = topHolland || "Ch∆∞a x√°c ƒë·ªãnh";

        // G·ªçi Gemini AI
        const prompt = `
            H√£y ƒë√≥ng vai chuy√™n gia h∆∞·ªõng nghi·ªáp. H·ªçc sinh ${user.name} (${new Date().getFullYear() - user.yob} tu·ªïi).
            - M√£ Holland n·ªïi tr·ªôi: ${topHolland}.
            - ƒê√£ ch·ªçn 5 ngh·ªÅ y√™u th√≠ch: ${user.finalSelection.map(i => i.nameVN).join(', ')}.
            H√£y vi·∫øt b√°o c√°o ng·∫Øn (HTML format, kh√¥ng markdown block) g·ªìm:
            1. <b>ƒêi·ªÉm m·∫°nh t√≠nh c√°ch:</b> D·ª±a tr√™n m√£ ${topHolland}.
            2. <b>Ph√¢n t√≠ch l·ª±a ch·ªçn:</b> T·∫°i sao b·∫°n ·∫•y h·ª£p v·ªõi c√°c ngh·ªÅ ƒë√£ ch·ªçn?
            3. <b>L·ªùi khuy√™n ph√°t tri·ªÉn:</b> C·ª• th·ªÉ cho l·ª©a tu·ªïi.
        `;
        
        try {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${CONFIG.AI_KEY}`;
            const res = await fetch(url, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
            });
            const data = await res.json();
            const content = data.candidates[0].content.parts[0].text;
            document.getElementById('ai-content').innerHTML = content;
            user.aiResult = content; // L∆∞u l·∫°i ƒë·ªÉ g·ª≠i mail
        } catch(e) {
            document.getElementById('ai-content').innerHTML = "L·ªói k·∫øt n·ªëi AI. Vui l√≤ng th·ª≠ l·∫°i.";
        }
    }

    function sendEmail() {
        const btn = document.getElementById('btn-send-mail');
        btn.innerText = "ƒêang g·ª≠i...";
        const formData = new FormData();
        formData.append('name', user.name);
        formData.append('email', user.email);
        formData.append('result', user.aiResult);

        fetch(CONFIG.SCRIPT_URL, { method:'POST', body: formData, mode: 'no-cors' })
        .then(() => { alert("ƒê√£ g·ª≠i email th√†nh c√¥ng!"); btn.innerText = "ƒê√£ g·ª≠i xong"; })
        .catch(() => alert("L·ªói g·ª≠i mail"));
    }

    // UI HELPER: MODAL
    function showModal(id) {
        const item = rawData.find(i => i.id === id);
        if(!item) return;
        document.getElementById('m-name-vn').innerText = item.nameVN;
        document.getElementById('m-name-en').innerText = item.nameEN;
        document.getElementById('m-group').innerText = item.group;
        document.getElementById('m-desc').innerText = item.desc;
        document.getElementById('m-subjects').innerText = item.subjects;
        document.getElementById('m-qualities').innerText = item.qualities;
        document.getElementById('m-fact').innerText = item.fact;
        document.getElementById('modal-info').style.display = 'flex';
    }
    function closeModal() {
        document.getElementById('modal-info').style.display = 'none';
    }
    
    function quitQuiz() {
        if(confirm("B·∫°n c√≥ mu·ªën d·ª´ng v√† v·ªÅ trang ch·ªß?")) goToScreen('screen-home');
    }

</script>

</body>
</html>
