<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tr·∫Øc nghi·ªám H∆∞·ªõng nghi·ªáp AI</title>
    <style>
        /* --- 1. CSS CHUNG & RESET --- */
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: #f0f2f5; margin: 0; padding: 10px; 
            text-align: center; color: #333; 
            overflow-x: hidden; /* Ch·∫∑n cu·ªôn ngang khi vu·ªët */
            overscroll-behavior: none; /* Ch·∫∑n k√©o trang tr√™n mobile */
        }
        
        /* Container ch√≠nh */
        .container { 
            max-width: 480px; margin: 0 auto; 
            background: white; padding: 20px; 
            border-radius: 20px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
            min-height: 85vh; 
            display: flex; flex-direction: column; 
            position: relative;
        }

        /* --- 2. LOGO & HEADER --- */
        #company-logo { 
            max-width: 120px; display: block; margin: 0 auto 10px; 
            animation: bounceIn 1s;
        }
        @keyframes bounceIn { 0%{transform:scale(0);} 60%{transform:scale(1.1);} 100%{transform:scale(1);} }

        h2 { margin: 10px 0; color: #2c3e50; }

        /* --- 3. FORM NH·∫¨P LI·ªÜU --- */
        .form-group { margin-bottom: 15px; text-align: left; }
        label { font-weight: bold; font-size: 0.9em; margin-bottom: 5px; display: block; color: #555; }
        
        input[type="text"], input[type="number"], input[type="email"] { 
            width: 100%; padding: 12px; border: 1px solid #ddd; 
            border-radius: 10px; box-sizing: border-box; font-size: 16px;
        }
        
        .gender-options { display: flex; gap: 10px; }
        .gender-btn { 
            flex: 1; padding: 12px; border: 1px solid #eee; 
            background: #f9f9f9; cursor: pointer; border-radius: 8px; 
            font-weight: 600; text-align: center; transition: 0.2s;
        }
        .gender-btn.active { background: #007bff; color: white; border-color: #007bff; }
        
        .btn-primary { 
            width: 100%; padding: 15px; background: #28a745; 
            color: white; border: none; border-radius: 30px; 
            font-size: 16px; font-weight: bold; cursor: pointer; 
            margin-top: 10px; box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
            transition: transform 0.2s;
        }
        .btn-primary:active { transform: scale(0.98); }

        /* --- 4. KHUNG TH·∫∫ TINDER (SWIPE CARD) --- */
        #quiz-screen { 
            position: relative; height: 550px; 
            display: none; flex-direction: column; 
        }
        
        #card-container { 
            position: relative; width: 100%; flex-grow: 1; margin-top: 10px; 
            perspective: 1000px;
        }
        
        .card-wrapper {
            position: absolute; width: 100%; height: 100%; top: 0; left: 0;
            background: white; border-radius: 20px; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            transform-origin: 50% 100%; /* Xoay t·ª´ ƒë√°y */
            cursor: grab;
            transition: transform 0.1s linear; /* M·∫∑c ƒë·ªãnh nhanh ƒë·ªÉ vu·ªët m∆∞·ª£t */
            display: flex; flex-direction: column; overflow: hidden;
        }
        
        /* Hi·ªáu ·ª©ng l·∫≠t m·∫∑t sau */
        .card-wrapper.is-flipped .card-face.front { transform: rotateY(180deg); }
        .card-wrapper.is-flipped .card-face.back { transform: rotateY(0deg); z-index: 10; }

        .card-face {
            position: absolute; width: 100%; height: 100%;
            backface-visibility: hidden; transition: transform 0.6s;
            background: white; top: 0; left: 0;
        }

        /* --- M·∫∂T TR∆Ø·ªöC --- */
        .card-face.front { z-index: 2; transform: rotateY(0deg); }
        .card-face.front img { width: 100%; height: 100%; object-fit: cover; }
        
        .text-overlay {
            position: absolute; bottom: 0; left: 0; width: 100%; 
            background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
            padding: 20px; padding-top: 60px; box-sizing: border-box; text-align: left;
            color: white;
        }
        .job-vn { font-size: 26px; font-weight: 800; margin: 0; line-height: 1.2; text-shadow: 0 2px 4px rgba(0,0,0,0.5); }
        .job-en { font-size: 16px; font-weight: 400; opacity: 0.9; margin-top: 4px; font-style: italic; color: #ddd; }
        .tap-hint { font-size: 12px; color: rgba(255,255,255,0.7); margin-top: 10px; text-transform: uppercase; letter-spacing: 1px; }

        /* --- M·∫∂T SAU --- */
        .card-face.back { 
            transform: rotateY(-180deg); z-index: 1; 
            display: flex; flex-direction: column;
            background: #fff;
        }
        .back-header { 
            background: #f8f9fa; padding: 15px; 
            border-bottom: 1px solid #eee; z-index: 5; 
            display: flex; align-items: center; gap: 15px;
        }
        .back-content { 
            padding: 15px; text-align: left; font-size: 0.95em; 
            color: #444; line-height: 1.6; overflow-y: auto; flex-grow: 1;
        }
        
        /* C√°c m·ª•c n·ªôi dung m·∫∑t sau */
        .section-title { color: #007bff; font-weight: bold; font-size: 0.95em; margin-top: 15px; display: block; border-left: 3px solid #007bff; padding-left: 8px; }
        .fun-fact { background: #fff3cd; padding: 12px; border-radius: 8px; font-style: italic; font-size: 0.9em; margin-top: 20px; border: 1px dashed #ffc107; }

        /* --- 5. N√öT B·∫§M TR√íN --- */
        .choice-buttons { 
            margin-top: 15px; display: flex; justify-content: center; gap: 40px; 
            padding-bottom: 10px; 
        }
        .btn-wrapper { display: flex; flex-direction: column; align-items: center; gap: 5px; }
        
        .btn-circle {
            width: 65px; height: 65px; border-radius: 50%; border: none; 
            display: flex; justify-content: center; align-items: center;
            font-size: 28px; cursor: pointer; 
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            background: white; transition: transform 0.2s, background 0.2s;
        }
        .btn-circle:active { transform: scale(0.9); }
        .btn-no { color: #ff4757; border: 2px solid #ff4757; }
        .btn-no:hover { background: #ffe0e3; }
        .btn-yes { color: #2ed573; border: 2px solid #2ed573; }
        .btn-yes:hover { background: #dcffe4; }
        .btn-label { font-size: 12px; font-weight: bold; color: #666; }

        /* Animation khi vu·ªët bay m√†u */
        .fly-left { transition: 0.5s !important; transform: translateX(-150%) rotate(-30deg) !important; opacity: 0; }
        .fly-right { transition: 0.5s !important; transform: translateX(150%) rotate(30deg) !important; opacity: 0; }

        /* --- 6. PH·∫¶N K·∫æT QU·∫¢ --- */
        #result-section { display: none; text-align: left; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        .result-box { background: #e9ecef; padding: 15px; border-radius: 10px; margin-bottom: 15px; }
        .ai-loading { text-align: center; color: #666; padding: 20px; background: #f8f9fa; border-radius: 10px; border: 1px solid #eee; }
        
        /* Spinner Loading */
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 0 auto 10px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        #loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.95); z-index: 9999; display: flex; justify-content: center; align-items: center; flex-direction: column; }
    </style>
</head>
<body>

<div id="loading-overlay">
    <div class="spinner"></div>
    <p>ƒêang t·∫£i d·ªØ li·ªáu ngh·ªÅ nghi·ªáp...</p>
</div>

<div class="container">
    <img id="company-logo" src="https://png.pngtree.com/png-clipart/20241011/original/pngtree-rainbow-dog-clipart-illustration---perfect-for-your-project-png-image_16270920.png" alt="Logo">

    <div id="info-form">
        <h2>Kh√°m Ph√° B·∫£n Th√¢n AI</h2>
        <p style="font-size: 0.9em; color: #666; margin-bottom: 20px;">D√†nh 2 ph√∫t ƒë·ªÉ t√¨m ra ngh·ªÅ nghi·ªáp ph√π h·ª£p nh·∫•t v·ªõi b·∫°n.</p>
        
        <div class="form-group">
            <label>H·ªç v√† T√™n</label>
            <input type="text" id="user-name" placeholder="V√≠ d·ª•: Nguy·ªÖn VƒÉn A">
        </div>
        <div class="form-group">
            <label>NƒÉm sinh</label>
            <input type="number" id="user-yob" placeholder="V√≠ d·ª•: 2005">
        </div>
        <div class="form-group">
            <label>Gi·ªõi t√≠nh</label>
            <div class="gender-options">
                <div class="gender-btn" onclick="selectGender('Nam', this)">Nam</div>
                <div class="gender-btn" onclick="selectGender('N·ªØ', this)">N·ªØ</div>
            </div>
        </div>
        <div class="form-group">
            <label>Email (Nh·∫≠n k·∫øt qu·∫£ chi ti·∫øt)</label>
            <input type="email" id="user-email" placeholder="email@example.com">
        </div>
        <button class="btn-primary" onclick="startApp()">B·∫ÆT ƒê·∫¶U NGAY ‚ûî</button>
    </div>

    <div id="quiz-screen">
        <div style="font-size: 0.8em; color: #999; margin-bottom: 5px;">Ch·∫°m v√†o th·∫ª ƒë·ªÉ xem chi ti·∫øt</div>
        
        <div id="card-container"></div>
        
        <div class="choice-buttons">
            <div class="btn-wrapper">
                <button class="btn-circle btn-no" onclick="triggerSwipe('left')">‚úñ</button>
                <span class="btn-label">Kh√¥ng th√≠ch</span>
            </div>
            <div class="btn-wrapper">
                <button class="btn-circle btn-yes" onclick="triggerSwipe('right')">‚ù§</button>
                <span class="btn-label">Th√≠ch</span>
            </div>
        </div>
    </div>

    <div id="result-section">
        <h2 style="color: #28a745;">üéâ Ho√†n th√†nh!</h2>
        <div class="result-box">
            <p><strong>H·ªç t√™n:</strong> <span id="res-name"></span></p>
            <p><strong>Email:</strong> <span id="res-email"></span></p>
        </div>

        <div id="ai-analysis">
            <div class="ai-loading">
                <div class="spinner"></div>
                ü§ñ AI ƒëang ph√¢n t√≠ch h·ªì s∆° v√† vi·∫øt b√°o c√°o ri√™ng cho b·∫°n...<br>(Vui l√≤ng ƒë·ª£i kho·∫£ng 5-10 gi√¢y)
            </div>
        </div>

        <hr style="border: 0; border-top: 1px solid #eee; margin: 20px 0;">
        <button id="btn-send-email" class="btn-primary" style="background:#6f42c1" onclick="sendEmailReport()">
            üìß G·ª¨I K·∫æT QU·∫¢ V·ªÄ EMAIL
        </button>
    </div>
</div>

<script>
/* ============================================================
   C·∫§U H√åNH H·ªÜ TH·ªêNG (B·∫†N C·∫¶N S·ª¨A PH·∫¶N N√ÄY)
   ============================================================ */
const CONFIG = {
    // 1. API KEY c·ªßa Google Gemini
    AI_KEY: "AIzaSyBvbJ9HBeJSqrWDI0HNWfvJZ29huFD5b9c", 
    
    // 2. Link CSV t·ª´ Google Sheet (Nh·ªõ Publish to Web -> ch·ªçn CSV)
    // C·∫•u tr√∫c Sheet b·∫Øt bu·ªôc 10 c·ªôt: 
    // ID | T√™nVN | T√™nEN | Group | ·∫¢nh1 | ·∫¢nh2 | M√¥ t·∫£ | M√¥nH·ªçc | Ph·∫©mCh·∫•t | Fact
    SHEET_CSV: "https://docs.google.com/spreadsheets/d/e/2PACX-1vTn_AISCPAvNtkZZcjcMn4_80wXuarbci9SyqBqDnnHpB5WM1QShft3xU7HHxgIP_AKz9ffyoEsAd9D/pub?output=csv", 
    
    // 3. Link Google Apps Script (T√πy ch·ªçn, ƒë·ªÉ g·ª≠i mail)
    SCRIPT_URL: "https://script.google.com/macros/s/AKfycbyliagMSTi8XV2z7wR2hCD2gm_25sXqftbw-J26gOE85bHflVyjAyShSiE2xywBjdqJ-A/exec"
};

/* ============================================================
   LOGIC ·ª®NG D·ª§NG
   ============================================================ */
let userProfile = { name: "", yob: 0, gender: "", email: "", scores: {}, selectedCards: [], aiResultText: "" };
let rawData = []; 
let quizData = []; 
let currentCardIndex = 0;

// --- 1. T·∫¢I D·ªÆ LI·ªÜU ---
async function initData() {
    try {
        const response = await fetch(CONFIG.SHEET_CSV);
        if (!response.ok) throw new Error("Kh√¥ng th·ªÉ t·∫£i CSV");
        const text = await response.text();
        rawData = parseCSV(text);
        
        console.log("ƒê√£ t·∫£i:", rawData.length, "ngh·ªÅ");
        document.getElementById('loading-overlay').style.display = 'none';
    } catch (error) {
        alert("L·ªói t·∫£i d·ªØ li·ªáu. Vui l√≤ng ki·ªÉm tra ƒë∆∞·ªùng link CSV.");
        console.error(error);
        document.getElementById('loading-overlay').innerHTML = "<p style='color:red'>L·ªói k·∫øt n·ªëi m√°y ch·ªß!</p>";
    }
}

function parseCSV(csvText) {
    const lines = csvText.trim().split('\n');
    const result = [];
    
    // Map icon nh√≥m ngh·ªÅ
    const groupIcons = {
        'R': 'https://cdn-icons-png.flaticon.com/512/3096/3096677.png',
        'I': 'https://cdn-icons-png.flaticon.com/512/2103/2103633.png',
        'A': 'https://cdn-icons-png.flaticon.com/512/2983/2983067.png',
        'S': 'https://cdn-icons-png.flaticon.com/512/3209/3209265.png',
        'E': 'https://cdn-icons-png.flaticon.com/512/2037/2037710.png',
        'C': 'https://cdn-icons-png.flaticon.com/512/2666/2666505.png'
    };

    // B·ªè qua d√≤ng ti√™u ƒë·ªÅ (i=1)
    for(let i = 1; i < lines.length; i++) {
        // Regex x·ª≠ l√Ω d·∫•u ph·∫©y trong ngo·∫∑c k√©p
        const row = lines[i].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
        if(row.length < 2) continue;

        const clean = (t) => t ? t.replace(/^"|"$/g, '').trim() : "ƒêang c·∫≠p nh·∫≠t";

        // Map ƒë√∫ng 10 c·ªôt d·ªØ li·ªáu m·ªõi
        let obj = {
            id: clean(row[0]),
            nameVN: clean(row[1]),
            nameEN: clean(row[2]),
            group: clean(row[3]),
            img1: clean(row[4]),
            img2: clean(row[5]),
            desc: clean(row[6]),
            subjects: clean(row[7]),
            qualities: clean(row[8]),
            fact: clean(row[9]),
            groupIcon: groupIcons[clean(row[3]).charAt(0).toUpperCase()] || "" 
        };
        result.push(obj);
    }
    return result;
}

initData();

// --- 2. X·ª¨ L√ù FORM & B·∫ÆT ƒê·∫¶U ---
function selectGender(gender, btn) {
    userProfile.gender = gender;
    document.querySelectorAll('.gender-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
}

function startApp() {
    userProfile.name = document.getElementById('user-name').value.trim();
    userProfile.yob = parseInt(document.getElementById('user-yob').value);
    userProfile.email = document.getElementById('user-email').value.trim();

    if (!userProfile.name || !userProfile.yob || !userProfile.email || !userProfile.gender) {
        alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!");
        return;
    }
    if (rawData.length === 0) {
        alert("D·ªØ li·ªáu ch∆∞a s·∫µn s√†ng. Vui l√≤ng ƒë·ª£i th√™m v√†i gi√¢y.");
        return;
    }

    // T√≠nh tu·ªïi & L·ªçc ·∫£nh
    const currentYear = new Date().getFullYear();
    userProfile.age = currentYear - userProfile.yob;
    const isGroup1 = (userProfile.age >= 10 && userProfile.age <= 14);

    // Random 20 c√¢u h·ªèi c√¢n b·∫±ng
    quizData = generateQuiz(20).map(item => ({
        ...item,
        displayImg: (isGroup1 ? item.img1 : item.img2) || "https://via.placeholder.com/400x600?text=No+Image"
    }));

    // Chuy·ªÉn m√†n h√¨nh
    document.getElementById('info-form').style.display = 'none';
    document.getElementById('quiz-screen').style.display = 'flex';
    renderCard(0);
}

function generateQuiz(count) {
    // Logic: L·∫•y ƒë·ªÅu c√°c nh√≥m
    let selected = [];
    const groups = ['R', 'I', 'A', 'S', 'E', 'C'];
    groups.forEach(g => {
        let items = rawData.filter(x => x.group.startsWith(g)).sort(() => 0.5 - Math.random());
        selected = selected.concat(items.slice(0, 4)); // L·∫•y 4 th·∫ª m·ªói nh√≥m
    });
    return selected.sort(() => 0.5 - Math.random()).slice(0, count);
}

// --- 3. RENDER TH·∫∫ & LOGIC VU·ªêT (SWIPE) ---
let currentCardEl = null;
let isDragging = false;
let startX = 0;

function renderCard(index) {
    if (index >= quizData.length) {
        finishQuiz();
        return;
    }

    const data = quizData[index];
    const container = document.getElementById('card-container');
    container.innerHTML = ''; 

    // HTML TH·∫∫ B√ÄI
    const cardHTML = `
        <div class="card-wrapper" id="current-card">
            <div class="card-face front">
                <img src="${data.displayImg}" draggable="false">
                <div class="text-overlay">
                    <h2 class="job-vn">${data.nameVN}</h2>
                    <p class="job-en">${data.nameEN}</p>
                    <div class="tap-hint">üëÜ Ch·∫°m ƒë·ªÉ l·∫≠t xem chi ti·∫øt</div>
                </div>
            </div>

            <div class="card-face back">
                <div class="back-header">
                    <img src="${data.groupIcon}" style="width: 40px; height: 40px;">
                    <div>
                        <h3 style="margin:0; font-size:1.1em">${data.nameVN}</h3>
                        <span style="background:#eee; padding:2px 8px; border-radius:4px; font-size:0.7em; font-weight:bold; color:#555">Nh√≥m RIASEC: ${data.group}</span>
                    </div>
                </div>
                <div class="back-content">
                    <span class="section-title">üìñ M√¥ t·∫£ c√¥ng vi·ªác</span>
                    <div>${data.desc}</div>

                    <span class="section-title">üìö M√¥n h·ªçc c·∫ßn gi·ªèi</span>
                    <div>${data.subjects}</div>

                    <span class="section-title">üíé Ph·∫©m ch·∫•t & K·ªπ nƒÉng</span>
                    <div>${data.qualities}</div>

                    <div class="fun-fact">üí° <b>C√≥ th·ªÉ b·∫°n ch∆∞a bi·∫øt:</b> ${data.fact}</div>
                </div>
            </div>
        </div>
    `;
    
    container.innerHTML = cardHTML;
    currentCardEl = document.getElementById('current-card');

    // S·ª± ki·ªán Click ƒë·ªÉ l·∫≠t (N·∫øu kh√¥ng vu·ªët)
    currentCardEl.addEventListener('click', (e) => {
        // Ch·ªâ l·∫≠t n·∫øu chu·ªôt di chuy·ªÉn r·∫•t √≠t (click, kh√¥ng ph·∫£i drag)
        if(!isDragging && Math.abs(startX - (e.clientX || e.changedTouches[0].clientX)) < 5) {
            currentCardEl.classList.toggle('is-flipped');
        }
    });

    initSwipe(currentCardEl);
}

// --- LOGIC VU·ªêT CHI TI·∫æT ---
function initSwipe(card) {
    card.addEventListener('touchstart', dragStart);
    card.addEventListener('touchmove', dragMove);
    card.addEventListener('touchend', dragEnd);
    
    card.addEventListener('mousedown', dragStart);
    document.addEventListener('mousemove', dragMove);
    document.addEventListener('mouseup', dragEnd);
}

function dragStart(e) {
    isDragging = true;
    startX = (e.type === 'touchstart') ? e.touches[0].clientX : e.clientX;
    currentCardEl.style.transition = 'none'; 
}

function dragMove(e) {
    if (!isDragging || !currentCardEl) return;
    
    // NgƒÉn ch·∫∑n h√†nh ƒë·ªông m·∫∑c ƒë·ªãnh (scroll)
    // e.preventDefault(); 
    
    const currentX = (e.type === 'touchmove') ? e.touches[0].clientX : e.clientX;
    const deltaX = currentX - startX;
    const rotate = deltaX * 0.05;

    currentCardEl.style.transform = `translateX(${deltaX}px) rotate(${rotate}deg)`;
    
    // ƒê·ªïi m√†u box-shadow g·ª£i √Ω
    if (deltaX > 20) currentCardEl.style.boxShadow = "0 0 20px rgba(46, 213, 115, 0.6)"; // Xanh
    else if (deltaX < -20) currentCardEl.style.boxShadow = "0 0 20px rgba(255, 71, 87, 0.6)"; // ƒê·ªè
    else currentCardEl.style.boxShadow = "";
}

function dragEnd(e) {
    if (!isDragging || !currentCardEl) return;
    isDragging = false;
    currentCardEl.style.transition = 'transform 0.4s ease-out';
    currentCardEl.style.boxShadow = "";

    const matrix = new WebKitCSSMatrix(getComputedStyle(currentCardEl).transform);
    const currentX = matrix.m41; 
    const threshold = 100;

    if (currentX > threshold) triggerSwipe('right');
    else if (currentX < -threshold) triggerSwipe('left');
    else currentCardEl.style.transform = `translateX(0) rotate(0)`;
}

// X·ª≠ l√Ω k·∫øt qu·∫£ Th√≠ch/Kh√¥ng th√≠ch
function triggerSwipe(direction) {
    if(!currentCardEl) return;
    
    const item = quizData[currentCardIndex];
    if (direction === 'right') {
        currentCardEl.classList.add('fly-right');
        // Ghi ƒëi·ªÉm
        const g = item.group.charAt(0).toUpperCase();
        userProfile.scores[g] = (userProfile.scores[g] || 0) + 1;
        userProfile.selectedCards.push(item.nameVN);
    } else {
        currentCardEl.classList.add('fly-left');
    }

    setTimeout(() => {
        currentCardIndex++;
        renderCard(currentCardIndex);
    }, 300);
}

// --- 4. K·∫æT TH√öC & G·ªåI AI ---
function finishQuiz() {
    document.getElementById('quiz-screen').style.display = 'none';
    document.getElementById('result-section').style.display = 'block';

    document.getElementById('res-name').innerText = userProfile.name;
    document.getElementById('res-email').innerText = userProfile.email;

    callGeminiAnalysis();
}

async function callGeminiAnalysis() {
    // T√¨m nh√≥m ƒëi·ªÉm cao nh·∫•t
    const sortedScores = Object.entries(userProfile.scores).sort((a, b) => b[1] - a[1]);
    const topGroups = sortedScores.slice(0, 3).map(x => x[0]).join(", ");
    
    // Prompt (ƒê√£ fix l·ªói SyntaxError)
    const prompt = `
        ƒê√≥ng vai chuy√™n gia h∆∞·ªõng nghi·ªáp. H√£y vi·∫øt b√°o c√°o cho h·ªçc sinh:
        - T√™n: ${userProfile.name}, ${userProfile.age} tu·ªïi.
        - Nh√≥m Holland n·ªïi tr·ªôi: ${topGroups || "Kh√¥ng r√µ r·ªát"}.
        - C√°c ngh·ªÅ ƒë√£ ch·ªçn th√≠ch: ${userProfile.selectedCards.join(", ") || "Kh√¥ng ch·ªçn ngh·ªÅ n√†o"}.

        H√£y vi·∫øt b√°o c√°o ng·∫Øn (HTML c∆° b·∫£n, kh√¥ng d√πng markdown code block) g·ªìm:
        1. <b>ƒêi·ªÉm m·∫°nh t√≠nh c√°ch:</b> D·ª±a tr√™n nh√≥m ${topGroups}.
        2. <b>G·ª£i √Ω ngh·ªÅ nghi·ªáp:</b> ƒê·ªÅ xu·∫•t 3 ngh·ªÅ c·ª• th·ªÉ ph√π h·ª£p nh·∫•t.
        3. <b>L·ªùi khuy√™n:</b> Ng·∫Øn g·ªçn ƒë·ªÉ ph√°t tri·ªÉn b·∫£n th√¢n.
        
        Gi·ªçng vƒÉn: Th√¢n thi·ªán, kh√≠ch l·ªá.
    `;

    try {
        const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${CONFIG.AI_KEY}`;
        const response = await fetch(url, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
        });
        
        const data = await response.json();
        const aiText = data.candidates[0].content.parts[0].text;
        
        userProfile.aiResultText = aiText;
        document.getElementById('ai-analysis').innerHTML = aiText;
        
    } catch (error) {
        console.error(error);
        document.getElementById('ai-analysis').innerHTML = "<p style='color:red'>H·ªá th·ªëng AI ƒëang b·∫≠n. B·∫°n h√£y b·∫•m g·ª≠i Email ƒë·ªÉ nh·∫≠n k·∫øt qu·∫£ sau.</p>";
    }
}

function sendEmailReport() {
    // H√†m n√†y k·∫øt n·ªëi t·ªõi Google Apps Script ƒë·ªÉ g·ª≠i mail
    const btn = document.getElementById('btn-send-email');
    btn.innerText = "‚è≥ ƒêang g·ª≠i...";
    btn.disabled = true;

    const formData = new FormData();
    formData.append('name', userProfile.name);
    formData.append('email', userProfile.email);
    formData.append('ai_analysis', userProfile.aiResultText);

    fetch(CONFIG.SCRIPT_URL, { method: 'POST', body: formData, mode: 'no-cors' })
    .then(() => {
        alert(`‚úÖ ƒê√£ g·ª≠i k·∫øt qu·∫£ t·ªõi ${userProfile.email}`);
        btn.innerText = "‚úî ƒê√£ g·ª≠i xong";
    })
    .catch(() => {
        alert("L·ªói g·ª≠i mail.");
        btn.innerText = "G·ª≠i l·∫°i";
        btn.disabled = false;
    });
}
</script>

</body>
</html>
