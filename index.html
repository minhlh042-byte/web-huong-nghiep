<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tr·∫Øc nghi·ªám ƒê·ªãnh h∆∞·ªõng Ngh·ªÅ nghi·ªáp AI</title>
    <style>
        /* --- CSS CHUNG --- */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f0f2f5; margin: 0; padding: 20px; text-align: center; color: #333; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        
        /* --- HI·ªÜU ·ª®NG LOGO --- */
        #company-logo { 
            max-width: 150px; display: block; margin: 0 auto 20px; 
            animation: logoBounceIn 1.2s cubic-bezier(0.68, -0.55, 0.27, 1.55) both;
        }
        @keyframes logoBounceIn {
            0% { opacity: 0; transform: scale(0.3) translateY(-100px); }
            50% { opacity: 1; transform: scale(1.1); }
            100% { transform: scale(1); translateY(0); }
        }

        /* --- INPUT FORM --- */
        .form-group { margin-bottom: 15px; text-align: left; }
        label { font-weight: bold; display: block; margin-bottom: 5px; }
        input[type="text"], input[type="number"], input[type="email"] { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 14px; }
        .gender-options { display: flex; gap: 10px; }
        .gender-btn { flex: 1; padding: 10px; border: 1px solid #ddd; background: #f9f9f9; cursor: pointer; border-radius: 8px; transition: 0.2s; }
        .gender-btn.active { background: #007bff; color: white; border-color: #007bff; font-weight: bold; }
        
        .btn-primary { width: 100%; padding: 14px; background: #28a745; color: white; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; margin-top: 10px; transition: 0.3s; font-weight: bold; }
        .btn-primary:hover { background: #218838; transform: translateY(-2px); }
        .btn-primary:disabled { background: #ccc; cursor: not-allowed; transform: none; }

        /* --- CARD & FLIP EFFECT --- */
        #card-container { perspective: 1000px; height: 450px; position: relative; margin-top: 20px; display: none; }
        .card-wrapper {
            width: 100%; height: 100%; position: absolute;
            transform-style: preserve-3d; transition: transform 0.6s; cursor: pointer;
        }
        .card-wrapper.is-flipped { transform: rotateY(180deg); }
        
        .card-face {
            position: absolute; width: 100%; height: 100%;
            backface-visibility: hidden; border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
            display: flex; flex-direction: column; align-items: center; justify-content: flex-start;
            background: white; padding: 20px; box-sizing: border-box; overflow: hidden;
        }
        .card-face.back { transform: rotateY(180deg); background: #f8f9fa; color: #333; justify-content: center; }
        
        /* Ch·ªânh ·∫£nh hi·ªÉn th·ªã g·ªçn ƒë·∫πp */
        .card-image-wrapper { width: 100%; height: 280px; overflow: hidden; border-radius: 10px; margin-bottom: 15px; }
        .card-face img { width: 100%; height: 100%; object-fit: cover; }
        .card-face h3 { margin: 10px 0 5px; font-size: 1.2em; color: #007bff; }

        /* Animation chia b√†i */
        .deal-animation { animation: dealCard 0.5s ease-out forwards; }
        @keyframes dealCard { from { opacity: 0; transform: translateY(-50px) scale(0.8); } to { opacity: 1; transform: translateY(0) scale(1); } }

        /* N√∫t ch·ªçn */
        .choice-buttons { margin-top: 20px; display: none; justify-content: center; gap: 30px; }
        .btn-choice { width: 130px; padding: 12px; border-radius: 30px; border: none; cursor: pointer; font-weight: bold; font-size: 16px; transition: transform 0.2s; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .btn-yes { background: #4caf50; color: white; }
        .btn-no { background: #f44336; color: white; }
        .btn-choice:active { transform: scale(0.95); }

        /* --- K·∫æT QU·∫¢ --- */
        #result-section { display: none; text-align: left; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        .ai-loading { text-align: center; color: #666; font-style: italic; padding: 20px; background: #f8f9fa; border-radius: 10px; }
        .result-box { background: #e9ecef; padding: 15px; border-radius: 10px; margin-bottom: 15px; font-size: 0.95em; }
        .toggle-btn { background: #17a2b8; color: white; padding: 10px; border: none; width: 100%; border-radius: 5px; cursor: pointer; margin-top: 10px; font-weight: bold; }
        .hidden-content { display: none; margin-top: 10px; padding: 15px; border: 1px dashed #ccc; background: #fff; border-radius: 5px; }
        
        .email-note { font-size: 0.8em; color: #d9534f; margin-top: 8px; font-style: italic; text-align: center; display: block;}
        
        /* Loading overlay khi t·∫£i d·ªØ li·ªáu */
        #loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.9); z-index: 9999; display: flex; justify-content: center; align-items: center; flex-direction: column; }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin-bottom: 10px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div id="loading-overlay">
    <div class="spinner"></div>
    <p>ƒêang t·∫£i d·ªØ li·ªáu t·ª´ m√°y ch·ªß...</p>
</div>

<div class="container">
    <img id="company-logo" src="https://cdn-icons-png.flaticon.com/512/4712/4712109.png" alt="Logo">

    <div id="info-form">
        <h2 style="color: #2c3e50;">Kh√°m Ph√° B·∫£n Th√¢n AI</h2>
        <p style="font-size: 0.9em; color: #666; margin-bottom: 20px;">D√†nh 2 ph√∫t ƒë·ªÉ hi·ªÉu r√µ t√≠nh c√°ch v√† ngh·ªÅ nghi·ªáp ph√π h·ª£p</p>
        
        <div class="form-group">
            <label>H·ªç v√† T√™n</label>
            <input type="text" id="user-name" placeholder="V√≠ d·ª•: Nguy·ªÖn VƒÉn A">
        </div>
        <div class="form-group">
            <label>NƒÉm sinh</label>
            <input type="number" id="user-yob" placeholder="V√≠ d·ª•: 2005">
        </div>
        <div class="form-group">
            <label>Gi·ªõi t√≠nh</label>
            <div class="gender-options">
                <div class="gender-btn" onclick="selectGender('Nam', this)">Nam</div>
                <div class="gender-btn" onclick="selectGender('N·ªØ', this)">N·ªØ</div>
            </div>
        </div>
        <div class="form-group">
            <label>Email (ƒê·ªÉ nh·∫≠n k·∫øt qu·∫£ chi ti·∫øt)</label>
            <input type="email" id="user-email" placeholder="email@example.com">
        </div>
        <button class="btn-primary" onclick="startApp()">B·∫ÆT ƒê·∫¶U KH√ÅM PH√Å</button>
    </div>

    <div id="quiz-screen" style="display:none;">
        <p style="color:#888; font-size: 0.9em; margin-bottom: 5px;">Ch·∫°m v√†o h√¨nh ƒë·ªÉ xem m√¥ t·∫£ chi ti·∫øt</p>
        <div id="card-container">
            </div>
        <div class="choice-buttons" id="choice-btns">
            <button class="btn-choice btn-no" onclick="handleChoice(false)">‚úñ Kh√¥ng</button>
            <button class="btn-choice btn-yes" onclick="handleChoice(true)">‚úî C√≥</button>
        </div>
    </div>

    <div id="result-section">
        <h2 style="color: #28a745;">K·∫øt qu·∫£ Ph√¢n t√≠ch</h2>
        <div class="result-box">
            <p><strong>H·ªç t√™n:</strong> <span id="res-name"></span></p>
            <p><strong>Th√¥ng tin:</strong> <span id="res-info"></span></p>
            <p><strong>Email:</strong> <span id="res-email"></span></p>
        </div>

        <div id="ai-analysis">
            <div class="ai-loading">
                <div class="spinner" style="margin: 0 auto;"></div>
                <br>ü§ñ AI ƒëang t·ªïng h·ª£p d·ªØ li·ªáu v√† vi·∫øt b√°o c√°o cho b·∫°n...<br>(Qu√° tr√¨nh n√†y m·∫•t kho·∫£ng 5-10 gi√¢y)
            </div>
        </div>

        <button class="toggle-btn" onclick="toggleDetails()">K·∫æT QU·∫¢ PH√ÇN LO·∫†I C·ª¶A B·∫†N ‚ñº</button>
        <div id="classification-details" class="hidden-content">
            <p style="font-weight:bold; margin-bottom:5px;">C√°c ho·∫°t ƒë·ªông b·∫°n y√™u th√≠ch:</p>
            <ul id="selected-cards-list" style="padding-left: 20px; color: #555;"></ul>
        </div>

        <hr style="border: 0; border-top: 1px solid #eee; margin: 20px 0;">
        <button id="btn-send-email" class="btn-primary" style="background:#6f42c1" onclick="sendEmailReport()">
            üìß NH·∫¨N K·∫æT QU·∫¢ PH√ÇN T√çCH QUA EMAIL
        </button>
        <span class="email-note">* K·∫øt qu·∫£ n√†y s·∫Ω bi·∫øn m·∫•t sau khi t·∫£i l·∫°i trang</span>
    </div>
</div>

<script>
// --- C·∫§U H√åNH LI√äN K·∫æT ---
const CONFIG = {
    // Key Gemini AI
    AI_KEY: "AIzaSyBvbJ9HBeJSqrWDI0HNWfvJZ29huFD5b9c",
    
    // Link Google Sheet xu·∫•t b·∫£n d∆∞·ªõi d·∫°ng CSV (Sheet ch·ª©a c√¢u h·ªèi)
    SHEET_CSV: "https://docs.google.com/spreadsheets/d/e/2PACX-1vTn_AISCPAvNtkZZcjcMn4_80wXuarbci9SyqBqDnnHpB5WM1QShft3xU7HHxgIP_AKz9ffyoEsAd9D/pub?output=csv",
    
    // Link Google Apps Script Web App (ƒê·ªÉ g·ª≠i Email)
    SCRIPT_URL: "https://script.google.com/macros/s/AKfycbyz4BHfAQ-PDpCZDeiWLY5-i_eMzDbSTVy9NZdJs5Dge9-AbaBKeiNBCYjeRBIp-8izww/exec"
};

// --- BI·∫æN TO√ÄN C·ª§C ---
let userProfile = { name: "", yob: 0, gender: "", email: "", scores: {}, selectedCards: [], aiResultText: "" };
let rawData = []; // D·ªØ li·ªáu g·ªëc
let quizData = []; // D·ªØ li·ªáu sau khi random
let currentCardIndex = 0;

// --- PH·∫¶N 1: T·∫¢I D·ªÆ LI·ªÜU T·ª™ GOOGLE SHEET ---
async function initData() {
    try {
        const response = await fetch(CONFIG.SHEET_CSV);
        const text = await response.text();
        rawData = parseCSV(text);
        
        console.log("ƒê√£ t·∫£i ƒë∆∞·ª£c:", rawData.length, "d√≤ng d·ªØ li·ªáu");
        document.getElementById('loading-overlay').style.display = 'none';
        
    } catch (error) {
        alert("L·ªói t·∫£i d·ªØ li·ªáu! Vui l√≤ng ki·ªÉm tra k·∫øt n·ªëi m·∫°ng.");
        console.error(error);
    }
}

// H√†m chuy·ªÉn ƒë·ªïi CSV sang JSON (C·∫ßn map ƒë√∫ng c·ªôt trong Sheet c·ªßa b·∫°n)
function parseCSV(csvText) {
    const lines = csvText.trim().split('\n');
    const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, '')); // L·∫•y header
    
    const result = [];
    for(let i = 1; i < lines.length; i++) {
        // T√°ch d·∫•u ph·∫©y nh∆∞ng b·ªè qua d·∫•u ph·∫©y trong ngo·∫∑c k√©p (Regex ƒë∆°n gi·∫£n)
        // L∆∞u √Ω: N·∫øu d·ªØ li·ªáu ƒë∆°n gi·∫£n kh√¥ng c√≥ d·∫•u ph·∫©y trong n·ªôi dung th√¨ d√πng .split(',') l√† ƒë·ªß
        const row = lines[i].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/); 
        
        if(row.length < 2) continue; // B·ªè qua d√≤ng tr·ªëng

        // Map d·ªØ li·ªáu v√†o object. 
        // GI·∫¢ ƒê·ªäNH TH·ª® T·ª∞ C·ªòT TRONG SHEET L√Ä: [ID, N·ªôi Dung, Nh√≥m, ·∫¢nh B√©, ·∫¢nh L·ªõn, M√¥ t·∫£]
        // N·∫øu Sheet b·∫°n kh√°c, h√£y s·ª≠a ch·ªâ s·ªë index [0], [1]... ·ªü d∆∞·ªõi
        const cleanCell = (txt) => txt ? txt.replace(/^"|"$/g, '').trim() : "";

        // T·ª± ƒë·ªông map n·∫øu header c√≥ t√™n gi·ªëng (ho·∫∑c map th·ªß c√¥ng theo th·ª© t·ª± c·ªôt)
        // ·ªû ƒë√¢y t√¥i map theo th·ª© t·ª± c·ªôt ph·ªï bi·∫øn ƒë·ªÉ an to√†n:
        let obj = {
            id: cleanCell(row[0]),
            name: cleanCell(row[1]),     // C·ªôt B: T√™n ngh·ªÅ/Ho·∫°t ƒë·ªông
            group: cleanCell(row[2]),    // C·ªôt C: Nh√≥m RIASEC (R, I, A...)
            img1: cleanCell(row[3]),     // C·ªôt D: Link ·∫£nh 10-14 tu·ªïi
            img2: cleanCell(row[4]),     // C·ªôt E: Link ·∫£nh 15+ tu·ªïi
            desc: cleanCell(row[5]) || "M√¥ t·∫£ ƒëang c·∫≠p nh·∫≠t..." // C·ªôt F: M√¥ t·∫£
        };
        result.push(obj);
    }
    return result;
}

// G·ªçi h√†m t·∫£i d·ªØ li·ªáu ngay khi ch·∫°y
initData();

// --- PH·∫¶N 2: LOGIC APP ---
function selectGender(gender, btn) {
    userProfile.gender = gender;
    document.querySelectorAll('.gender-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
}

function startApp() {
    // Validate Input
    userProfile.name = document.getElementById('user-name').value.trim();
    userProfile.yob = parseInt(document.getElementById('user-yob').value);
    userProfile.email = document.getElementById('user-email').value.trim();

    if (!userProfile.name || !userProfile.yob || !userProfile.email || !userProfile.gender) {
        alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin ƒë·ªÉ b·∫Øt ƒë·∫ßu!");
        return;
    }

    if (rawData.length === 0) {
        alert("D·ªØ li·ªáu ch∆∞a t·∫£i xong. Vui l√≤ng ƒë·ª£i 3 gi√¢y v√† th·ª≠ l·∫°i.");
        return;
    }

    // T√≠nh tu·ªïi
    const currentYear = new Date().getFullYear();
    userProfile.age = currentYear - userProfile.yob;
    const isGroup1 = (userProfile.age >= 10 && userProfile.age <= 14);

    // CHU·∫®N B·ªä B·ªò C√ÇU H·ªéI (Random 30 c√¢u c√¢n b·∫±ng)
    quizData = generateBalancedQuiz(30).map(item => ({
        ...item,
        // Ch·ªçn ·∫£nh ph√π h·ª£p tu·ªïi, n·∫øu kh√¥ng c√≥ l·∫•y ·∫£nh placeholder
        displayImg: (isGroup1 ? item.img1 : item.img2) || "https://via.placeholder.com/400x300?text=No+Image"
    }));

    // Chuy·ªÉn giao di·ªán
    document.getElementById('info-form').style.display = 'none';
    document.getElementById('quiz-screen').style.display = 'block';
    document.getElementById('choice-btns').style.display = 'flex';
    
    renderCard(0);
}

function generateBalancedQuiz(totalCount) {
    const countPerGroup = Math.floor(totalCount / 6); 
    let selected = [];
    const groups = ['R', 'I', 'A', 'S', 'E', 'C'];
    
    groups.forEach(g => {
        let groupItems = rawData.filter(x => x.group && x.group.toUpperCase() === g);
        // Shuffle
        groupItems.sort(() => 0.5 - Math.random());
        // L·∫•y 5 th·∫ª
        selected = selected.concat(groupItems.slice(0, countPerGroup));
    });
    
    // Shuffle l·∫ßn cu·ªëi
    return selected.sort(() => 0.5 - Math.random());
}

// --- PH·∫¶N 3: HI·ªÇN TH·ªä & T∆Ø∆†NG T√ÅC ---
function renderCard(index) {
    if (index >= quizData.length) {
        finishQuiz();
        return;
    }

    const data = quizData[index];
    const container = document.getElementById('card-container');
    
    container.innerHTML = `
        <div class="card-wrapper deal-animation" onclick="this.classList.toggle('is-flipped')">
            <div class="card-face front">
                <div class="card-image-wrapper">
                    <img src="${data.displayImg}" alt="Job Image" onerror="this.src='https://via.placeholder.com/400?text=·∫¢nh+L·ªói'">
                </div>
                <h3>${data.name}</h3>
                <p style="font-size:0.8em; color:#999; margin-top: auto;">(Ch·∫°m v√†o th·∫ª ƒë·ªÉ l·∫≠t)</p>
            </div>
            <div class="card-face back">
                <h3 style="color:#333">Th√¥ng tin ngh·ªÅ</h3>
                <p style="text-align:justify; padding:0 10px;">${data.desc}</p>
                <div style="margin-top:auto; font-weight:bold; color:#007bff; border:1px solid #007bff; padding:5px 15px; border-radius:20px;">
                    Nh√≥m: ${data.group}
                </div>
            </div>
        </div>
    `;
}

function handleChoice(isLike) {
    const currentItem = quizData[currentCardIndex];
    if (isLike) {
        const g = currentItem.group.toUpperCase();
        userProfile.scores[g] = (userProfile.scores[g] || 0) + 1;
        userProfile.selectedCards.push(`${currentItem.name} (${g})`);
    }
    
    currentCardIndex++;
    // Delay nh·ªè ƒë·ªÉ t·∫°o c·∫£m gi√°c m∆∞·ª£t
    setTimeout(() => renderCard(currentCardIndex), 200);
}

// --- PH·∫¶N 4: K·∫æT QU·∫¢ & AI & G·ª¨I EMAIL ---
function finishQuiz() {
    document.getElementById('quiz-screen').style.display = 'none';
    document.getElementById('result-section').style.display = 'block';

    // ƒêi·ªÅn th√¥ng tin
    document.getElementById('res-name').innerText = userProfile.name;
    document.getElementById('res-info').innerText = `${userProfile.age} tu·ªïi - ${userProfile.gender}`;
    document.getElementById('res-email').innerText = userProfile.email;

    // List c√°c th·∫ª ƒë√£ ch·ªçn
    const listHtml = userProfile.selectedCards.map(item => `<li>${item}</li>`).join('');
    document.getElementById('selected-cards-list').innerHTML = listHtml || "<li>B·∫°n kh√¥ng ch·ªçn ho·∫°t ƒë·ªông n√†o c·ª• th·ªÉ.</li>";

    // G·ªçi AI ph√¢n t√≠ch
    callGeminiAnalysis();
}

async function callGeminiAnalysis() {
    // L·∫•y top 3 nh√≥m ƒëi·ªÉm cao
    const sortedScores = Object.entries(userProfile.scores).sort((a, b) => b[1] - a[1]);
    const topGroups = sortedScores.slice(0, 3).map(x => x[0]).join(", ");
    
    // Prompt cho AI
    const prompt = `
        B·∫°n l√† chuy√™n gia t∆∞ v·∫•n h∆∞·ªõng nghi·ªáp. H√£y ph√¢n t√≠ch cho ng∆∞·ªùi d√πng:
        - T√™n: ${userProfile.name}, ${userProfile.age} tu·ªïi, gi·ªõi t√≠nh ${userProfile.gender}.
        - K·∫øt qu·∫£ tr·∫Øc nghi·ªám Holland (RIASEC) n·ªïi tr·ªôi ·ªü c√°c nh√≥m: ${topGroups || "Ch∆∞a r√µ r·ªát"}.
        
        H√£y vi·∫øt m·ªôt b√°o c√°o ng·∫Øn (ƒë·ªãnh d·∫°ng HTML c∆° b·∫£n, tuy·ªát ƒë·ªëi kh√¥ng b·ªçc trong th·∫ª code block) g·ªìm:
        1. <b>T√≠nh c√°ch n·ªïi b·∫≠t:</b> Nh·∫≠n x√©t d·ª±a tr√™n nh√≥m ${topGroups}.
        2. <b>M√¥i tr∆∞·ªùng l√†m vi·ªác ph√π h·ª£p:</b> M√¥ t·∫£ kh√¥ng gian l√†m vi·ªác.
        3. <b>Top 5 ngh·ªÅ nghi·ªáp g·ª£i √Ω:</b> Li·ªát k√™ c·ª• th·ªÉ.
        4. <b>L·ªùi khuy√™n ph√°t tri·ªÉn:</b> Ng·∫Øn g·ªçn.
        
        Gi·ªçng vƒÉn t√≠ch c·ª±c, khuy·∫øn kh√≠ch, d·ªÖ hi·ªÉu v·ªõi l·ª©a tu·ªïi ${userProfile.age}.
    `;

    try {
        const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${CONFIG.AI_KEY}`;
        const response = await fetch(url, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
        });
        
        const data = await response.json();
        const aiText = data.candidates[0].content.parts[0].text;
        
        // L∆∞u k·∫øt qu·∫£ ƒë·ªÉ g·ª≠i mail
        userProfile.aiResultText = aiText;
        
        // Hi·ªÉn th·ªã ra m√†n h√¨nh
        document.getElementById('ai-analysis').innerHTML = aiText;
        
    } catch (error) {
        console.error("L·ªói AI:", error);
        document.getElementById('ai-analysis').innerHTML = "<p style='color:red'>H·ªá th·ªëng AI ƒëang b·∫≠n. B·∫°n v·∫´n c√≥ th·ªÉ nh·∫≠n k·∫øt qu·∫£ qua Email.</p>";
        userProfile.aiResultText = "H·ªá th·ªëng AI kh√¥ng ph·∫£n h·ªìi l√∫c n√†y. Tuy nhi√™n d·ª±a tr√™n ƒëi·ªÉm s·ªë, b·∫°n thu·ªôc nh√≥m n·ªïi b·∫≠t: " + topGroups;
    }
}

// --- PH·∫¶N 5: G·ª¨I EMAIL (K·∫øt n·ªëi Apps Script) ---
function sendEmailReport() {
    const btn = document.getElementById('btn-send-email');
    btn.innerText = "‚è≥ ƒêang g·ª≠i d·ªØ li·ªáu...";
    btn.disabled = true;

    // Chu·∫©n b·ªã d·ªØ li·ªáu g·ª≠i ƒëi (Mapping v·ªõi Google Apps Script c·ªßa b·∫°n)
    // Script c·ªßa b·∫°n c·∫ßn nh·∫≠n c√°c tham s·ªë n√†y trong h√†m doPost(e)
    const formData = new FormData();
    formData.append('name', userProfile.name);
    formData.append('email', userProfile.email);
    formData.append('age', userProfile.age);
    formData.append('gender', userProfile.gender);
    formData.append('top_groups', userProfile.selectedCards.join(", ")); // Ho·∫∑c g·ª≠i ƒëi·ªÉm s·ªë
    formData.append('ai_analysis', userProfile.aiResultText); // N·ªôi dung AI vi·∫øt
    
    // G·ª≠i request t·ªõi Google Apps Script
    fetch(CONFIG.SCRIPT_URL, {
        method: 'POST',
        body: formData,
        mode: 'no-cors' // Quan tr·ªçng: no-cors ƒë·ªÉ tr√°nh l·ªói ch·∫∑n t·ª´ tr√¨nh duy·ªát khi g·ªçi Google Script
    })
    .then(() => {
        // V√¨ no-cors kh√¥ng tr·∫£ v·ªÅ status chu·∫©n, ta gi·∫£ ƒë·ªãnh th√†nh c√¥ng n·∫øu request ƒëi ƒë∆∞·ª£c
        alert(`‚úÖ ƒê√£ g·ª≠i th√†nh c√¥ng!\nVui l√≤ng ki·ªÉm tra h·ªôp th∆∞ (c·∫£ m·ª•c Spam) c·ªßa email: ${userProfile.email}`);
        btn.innerText = "‚úî ƒê√£ g·ª≠i xong";
    })
    .catch(error => {
        console.error('L·ªói g·ª≠i mail:', error);
        alert("C√≥ l·ªói khi g·ª≠i email. Vui l√≤ng th·ª≠ l·∫°i!");
        btn.innerText = "G·ª≠i l·∫°i";
        btn.disabled = false;
    });
}

// Ti·ªán √≠ch
function toggleDetails() {
    const el = document.getElementById('classification-details');
    el.style.display = (el.style.display === 'none' || el.style.display === '') ? 'block' : 'none';
}
</script>

</body>

</html>

